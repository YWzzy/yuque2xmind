{"format":"lakeboard","type":"Board","version":"1.0","diagramData":{"head":{"version":"2.0.0","theme":{"name":"default"},"rough":{"name":"default"}},"body":[{"id":"32d9bd83-e3e6-48af-b4a4-61e258bbe513","html":"babel","type":"mindmap","children":[{"id":"2b9f6275-c16d-403a-b04b-39073b03374a","html":"babel是什么","treeEdge":{"stroke":"#A287E1","stroke-width":2},"children":[{"id":"336344cb-d10a-4f2c-9cd5-d31f22126e65","children":[],"html":"一个JavaScript编译器","treeEdge":{"stroke-width":2},"zIndex":33},{"id":"6a372b0c-dc15-4188-84a3-3969fdf13f9d","children":[{"id":"91eee41e-31a8-4704-987a-80084bc39938","children":[],"html":"parsing","treeEdge":{"stroke-width":2},"zIndex":30},{"id":"ad11d7cd-35de-4c34-bf53-9061b1305069","children":[],"html":"transforming","treeEdge":{"stroke-width":2},"zIndex":31},{"id":"228ad8b0-d27b-4a4f-860b-a65542080e87","children":[],"html":"printing","treeEdge":{"stroke-width":2},"zIndex":29}],"html":"执行步骤","treeEdge":{"stroke-width":2},"zIndex":32}],"zIndex":34},{"id":"899f4f64-bcfd-4e3d-a671-b7993698372c","children":[{"id":"61063d39-cca4-4c86-bd48-af7d6a816196","children":[{"id":"bf5f0844-1ee3-4e34-8abb-6fb64fc7dc15","children":[{"id":"10dcc65b-c70d-4908-a687-154001c5a413","children":[],"html":"一直到ES2021的polyfill","treeEdge":{"stroke-width":2},"zIndex":51},{"id":"dd32cc24-8302-41d7-bdfc-3962ffad6c58","children":[],"html":"promise、symbols、iterators等一些特性的实现","treeEdge":{"stroke-width":2},"zIndex":53},{"id":"190dad4c-733f-4ebc-95a7-8f87d541a4dd","children":[],"html":"ES提案中的特性实现","treeEdge":{"stroke-width":2},"zIndex":52},{"id":"54896c5b-8c78-45ea-a5de-5d4e0e67c51e","children":[],"html":"跨平台的WHATWG / W3C特性，比如URL","treeEdge":{"stroke-width":2},"zIndex":50}],"html":"一套模块化的JS标准库，提供Babel的核心功能","layout":{"quadrant":1},"treeEdge":{"stroke-width":2},"zIndex":54},{"id":"8ca61515-fd32-46cd-bc06-6c27a7fb09d5","children":[{"id":"232a8fc9-bfe4-4096-bdc7-9afa0a4ca633","children":[{"html":"提供了polyfill的核心实现","id":"a0ffbaa0-a1e5-4f4d-9ad9-7d7a97c238fb","children":[],"treeEdge":{"stroke-width":2},"zIndex":56}],"html":"core-js","treeEdge":{"stroke-width":2},"zIndex":57},{"id":"fe9c581f-02c6-489b-97a5-1adc91f10146","children":[{"id":"482d1651-ca9e-438f-bde9-1cf170d3b097","children":[],"html":"提供了独立的命名空间","treeEdge":{"stroke-width":2},"zIndex":59}],"html":"core-js-pure","treeEdge":{"stroke-width":2},"zIndex":60},{"id":"3e43c19e-191d-417d-9719-2180d8d6e00a","children":[{"id":"e78725ee-18bd-4d41-802d-52c89f42b768","children":[],"html":"根据Browserslist维护了不同宿主环境、不同版本下对应需要支持特性的集合。","treeEdge":{"stroke-width":2},"zIndex":61}],"html":"core-js-compat","treeEdge":{"stroke-width":2},"zIndex":62},{"id":"f5b909d6-a05a-4fbc-b696-f3e9aa38bd3b","children":[],"html":"core-js-bundle","treeEdge":{"stroke-width":2},"zIndex":58},{"id":"997437ba-b588-407f-a4e8-ce33178846e7","children":[],"html":"core-js-builder","treeEdge":{"stroke-width":2},"zIndex":55}],"html":"代码仓库","layout":{"quadrant":1},"treeEdge":{"stroke-width":2},"zIndex":63},{"id":"256666d6-21b7-450f-b963-ddcb9d72addf","children":[{"id":"93c35c89-ac72-4ade-8696-524404f466d8","children":[],"html":"@babel/polyfill = core-js + regenerator-runtime","treeEdge":{"stroke-width":2},"zIndex":46},{"id":"b8941627-fe14-4c2c-8ec8-31a299403100","children":[],"html":"regenerator-runtime是generator以及async/await的运行时依赖","treeEdge":{"stroke-width":2},"zIndex":48},{"id":"0e9ffb85-c1ff-4e25-b5f4-5c7629ea765d","children":[],"html":"单独使用@babel/polyfill会将core-js全量导入，造成项目打包体积过大。","treeEdge":{"stroke-width":2},"zIndex":47},{"id":"cb4adb84-f9a2-4533-9854-7bb0c07e23bf","children":[],"html":"为了解决全量引入core-js造成打包体积过大的问题，我们需要配合使用@babel/preset-env。","treeEdge":{"stroke-width":2},"zIndex":45}],"html":"@babel/polyfill与core-js关系","layout":{"quadrant":1},"treeEdge":{"stroke-width":2},"zIndex":49}],"html":"@babel/core","treeEdge":{"stroke-width":2},"zIndex":64},{"id":"ef94c5df-b3cb-4dee-9a22-aacf79c1ef9f","children":[],"html":"由@babel/parser、@babel/traverse、@babel/types、@babel/generator等组成","treeEdge":{"stroke-width":2},"zIndex":66},{"id":"1d8a4b1f-aabb-4f6b-92cb-6a95615af958","children":[],"html":"提供了Babel编译JS的能力","treeEdge":{"stroke-width":2},"zIndex":65},{"id":"595da87e-1c16-4e1c-ae4f-696444fcd07f","children":[],"html":"@babel/core为库名，babel-core为其在仓库中对应文件名","treeEdge":{"stroke-width":2},"zIndex":44}],"html":"底层能力","treeEdge":{"stroke":"#E48484","stroke-width":2},"zIndex":67},{"id":"2f7605e2-3e1b-4c48-a4ae-49e18b5dd620","children":[{"id":"db43806e-2c5a-44f5-ae24-03a2a80adeee","children":[],"html":"@babel/plugin-*，Babel对外暴露的API，使开发者可以介入其编译JS的能力","treeEdge":{"stroke-width":2},"zIndex":42},{"id":"cdbf9147-d15b-4995-a513-9dc949cfc2a3","children":[{"id":"3a31d49d-0b81-4426-b4a0-9f6e5d05372a","children":[],"html":"初始情况下，Babel没有任何额外能力，其工作流程可以描述为：<div>const babel = code =&gt; code;</div>","treeEdge":{"stroke-width":2},"zIndex":39},{"id":"67e72af4-53a2-4296-b8cd-986d121a3339","children":[],"html":"babel通过plugin对外提供介入babel-core的能力，类似webpack的plugin对外提供介入webpack编译流程的能力。","treeEdge":{"stroke-width":2},"zIndex":40},{"id":"a964c5a6-481e-4df5-b5ab-86ca693075e9","children":[{"id":"cffcfd54-2fba-465b-b46b-9111b4cedc69","children":[],"html":"@babel/plugin-syntax-*语法相关插件，用于新的语法支持。比如babel-plugin-syntax-decorators[6]提供decorators的语法支持","treeEdge":{"stroke-width":2},"zIndex":36},{"id":"85848943-e3a7-4db0-8a06-5b06990f1e5d","children":[],"html":"@babel/plugin-proposal-*用于ES提案的特性支持，比如babel-plugin-proposal-optional-chaining是可选链操作符特性支持","treeEdge":{"stroke-width":2},"zIndex":37},{"id":"c5be71cb-06ad-47bd-9746-37eb466b5742","children":[],"html":"@babel/plugin-transform-*用于转换代码，transform插件内部会使用对应syntax插件","treeEdge":{"stroke-width":2},"zIndex":35}],"html":"分类","treeEdge":{"stroke-width":2},"zIndex":38}],"html":"plugins","treeEdge":{"stroke-width":2},"zIndex":41}],"html":"中层能力","treeEdge":{"stroke":"#69B1E4","stroke-width":2},"zIndex":43},{"id":"3dbde8e7-d543-40d9-9c31-b1935b8cb6df","children":[{"id":"fc94512b-aff5-403e-af36-4410a52e86db","children":[{"id":"af315303-abef-44cd-81c4-78b69fa2b5fc","children":[{"id":"f6d8e253-82fb-4a14-bb3d-a56e51220815","children":[],"html":"高级语法的降级实现以及API的polyfill","treeEdge":{"stroke-width":2},"zIndex":23},{"id":"264d3fc9-2ec7-4f6f-a916-52c6fe3fe925","children":[{"id":"6dedba56-9fce-433d-bd2b-990affc9fb3e","children":[],"html":"@babel/polyfill","treeEdge":{"stroke-width":2},"zIndex":21},{"id":"2dcea50d-8215-4887-b17e-ce70bdffd315","children":[],"html":"@babel/preset-env","treeEdge":{"stroke-width":2},"zIndex":20}],"html":"生态库","treeEdge":{"stroke-width":2},"zIndex":22}],"html":"polyfill","treeEdge":{"stroke-width":2},"zIndex":24},{"id":"f18a4731-6141-44ed-90be-d048b5b9232f","children":[],"html":"DSL转换（比如解析JSX）","treeEdge":{"stroke-width":2},"zIndex":26},{"id":"512fb436-83ba-406e-9737-eec3f759da79","children":[],"html":"语法转换（比如将高级语法解析为当前可用的实现）","treeEdge":{"stroke-width":2},"zIndex":25},{"id":"6cf27b65-2909-4d06-aa65-4ff5bde1be9f","children":[{"id":"fcfd3dfd-b929-4245-9bcd-b8a6b963b39f","children":[],"html":"core-js","treeEdge":{"stroke-width":2},"zIndex":18}],"html":"谁实现DSL和语法的转换功能","treeEdge":{"stroke-width":2},"zIndex":19}],"html":"@babel/preset-*，日常开发会使用的插件集合，提供能力主要包括：","treeEdge":{"stroke-width":2},"zIndex":27},{"layout":{"quadrant":1},"treeEdge":{"stroke-width":2},"id":"c46362cd-0b83-4d94-b2e5-a5f5c25dac97","children":[{"id":"00778980-7df7-46af-8775-cab109f0dbaa","children":[{"treeEdge":{"stroke-width":2},"id":"b439f05f-d0f6-4cd1-a32a-be260661df27","children":[],"html":"方便开发者使用一组插件，而不是一个一个配置","zIndex":15}],"html":"多个plugin组合在一起形成的集合，被称为preset","treeEdge":{"stroke-width":2},"zIndex":16},{"id":"62fe4162-bee7-4b68-bf96-39d4f525db2c","children":[{"treeEdge":{"stroke-width":2},"id":"fbcaeb70-bb87-45e0-8af9-066374432fef","children":[],"html":"主要作用是对我们所使用的并且目标浏览器中缺失的功能进行代码转换和加载 polyfill","zIndex":8},{"id":"6239e69f-9429-4b54-a159-4b96c0d9a926","children":[],"html":"可以「按需」将core-js中的特性打包，这样可以显著减少最终打包的体积。","treeEdge":{"stroke-width":2},"zIndex":9},{"id":"5c8f8b34-f773-405c-abcb-5e70f03ca49d","children":[{"id":"d209da9a-3d59-4bbf-b6bc-28b8ccbdf410","children":[],"html":"宿主环境的粒度：根据不同宿主环境将该环境下所需的所有特性打包","treeEdge":{"stroke-width":2},"zIndex":12},{"id":"5732ee3e-591a-4fc0-974b-6ea4d32c6209","children":[{"id":"2c44126b-6285-4e62-837e-a03425a40304","children":[],"html":"可以设置@babel/preset-env的useBuiltIns属性为usage","treeEdge":{"stroke-width":2},"zIndex":10}],"html":"按使用情况的粒度：仅仅将使用了的特性打包","treeEdge":{"stroke-width":2},"zIndex":11}],"html":"按需的粒度","treeEdge":{"stroke-width":2},"zIndex":13},{"id":"46c3bb9a-a8d1-478f-ae89-5dd014afc8f5","children":[{"id":"40858339-26a5-4c46-bb12-bfddfe17a388","children":[],"html":"需要使用「辅助方法」的module都从同一个地方引用，而不是自己维护一份。","treeEdge":{"stroke-width":2},"zIndex":3},{"id":"b0492169-99f5-43de-8bf9-3a21528c1532","children":[{"id":"e848948a-3848-49f2-9e31-85bd69d4d90e","children":[],"html":"包含了Babel所有「辅助方法」以及regenerator-runtime。","treeEdge":{"stroke-width":2},"zIndex":5},{"id":"004c92ce-470d-497c-b4a3-3d47ff1a1610","children":[],"html":"dependence，运行时使用","treeEdge":{"stroke-width":2},"zIndex":4}],"html":"@babel/runtime","treeEdge":{"stroke-width":2},"zIndex":6},{"id":"45fb325c-ae81-491c-b0ab-c1873cb04047","children":[{"id":"97b7a55e-12b9-493c-80b1-06dc30e90976","children":[],"html":"这个插件会在编译时将所有使用「辅助方法」的地方从「自己维护一份」改为从@babel/runtime中引入。","treeEdge":{"stroke-width":2},"zIndex":1},{"id":"1e155fa7-b6f1-4572-b42c-79b391ac2f9f","children":[],"html":"devDependence，编译时使用","zIndex":0,"treeEdge":{"stroke-width":2}}],"html":"@babel/plugin-transform-runtime","treeEdge":{"stroke-width":2},"zIndex":2}],"html":"进一步优化打包体积","treeEdge":{"stroke-width":2},"zIndex":7}],"html":"@babel/preset-env","treeEdge":{"stroke-width":2},"zIndex":14}],"html":"preset","zIndex":17}],"html":"上层能力","treeEdge":{"stroke":"#DE81C6","stroke-width":2},"zIndex":28}],"x":652,"y":1182.765625,"tapered":false,"rainbow":true,"treeEdge":{"shape":"polyline"},"border":{"fill":"#e1effa"},"layout":{"type":"standard"},"zIndex":68}]},"mode":"edit","viewportSetting":{"zoom":1,"tlCanvasPoint":[8,819.5,1],"width":1601,"height":949},"viewportOption":"adapt","text":"babelbabel是什么一个JavaScript编译器执行步骤parsingtransformingprinting底层能力@babel/core一套模块化的JS标准库，提供Babel的核心功能一直到ES2021的polyfillpromise、symbols、iterators等一些特性的实现ES提案中的特性实现跨平台的WHATWG / W3C特性，比如URL代码仓库core-js提供了polyfill的核心实现core-js-pure提供了独立的命名空间core-js-compat根据Browserslist维护了不同宿主环境、不同版本下对应需要支持特性的集合。core-js-bundlecore-js-builder@babel/polyfill与core-js关系@babel/polyfill = core-js + regenerator-runtimeregenerator-runtime是generator以及async/await的运行时依赖单独使用@babel/polyfill会将core-js全量导入，造成项目打包体积过大。为了解决全量引入core-js造成打包体积过大的问题，我们需要配合使用@babel/preset-env。由@babel/parser、@babel/traverse、@babel/types、@babel/generator等组成提供了Babel编译JS的能力@babel/core为库名，babel-core为其在仓库中对应文件名中层能力@babel/plugin-*，Babel对外暴露的API，使开发者可以介入其编译JS的能力plugins初始情况下，Babel没有任何额外能力，其工作流程可以描述为：const babel = code => code;babel通过plugin对外提供介入babel-core的能力，类似webpack的plugin对外提供介入webpack编译流程的能力。分类@babel/plugin-syntax-*语法相关插件，用于新的语法支持。比如babel-plugin-syntax-decorators[6]提供decorators的语法支持@babel/plugin-proposal-*用于ES提案的特性支持，比如babel-plugin-proposal-optional-chaining是可选链操作符特性支持@babel/plugin-transform-*用于转换代码，transform插件内部会使用对应syntax插件上层能力@babel/preset-*，日常开发会使用的插件集合，提供能力主要包括：polyfill高级语法的降级实现以及API的polyfill生态库@babel/polyfill@babel/preset-envDSL转换（比如解析JSX）语法转换（比如将高级语法解析为当前可用的实现）谁实现DSL和语法的转换功能core-jspreset多个plugin组合在一起形成的集合，被称为preset方便开发者使用一组插件，而不是一个一个配置@babel/preset-env主要作用是对我们所使用的并且目标浏览器中缺失的功能进行代码转换和加载 polyfill可以「按需」将core-js中的特性打包，这样可以显著减少最终打包的体积。按需的粒度宿主环境的粒度：根据不同宿主环境将该环境下所需的所有特性打包按使用情况的粒度：仅仅将使用了的特性打包可以设置@babel/preset-env的useBuiltIns属性为usage进一步优化打包体积需要使用「辅助方法」的module都从同一个地方引用，而不是自己维护一份。@babel/runtime包含了Babel所有「辅助方法」以及regenerator-runtime。dependence，运行时使用@babel/plugin-transform-runtime这个插件会在编译时将所有使用「辅助方法」的地方从「自己维护一份」改为从@babel/runtime中引入。devDependence，编译时使用","graphicsBBox":{"x":652,"y":433,"width":1552,"height":1895.5}}